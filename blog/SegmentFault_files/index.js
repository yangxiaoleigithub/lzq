define("template",["jquery"],function(e){return function(t,n){var o=t||"";return e.each(n,function(t,n){var i=typeof n,a=new RegExp("{{\\s*"+t+"\\s*}}","g");"object"===i&&null!==n?e.each(n,function(e,n){var i=new RegExp("{{\\s*"+t+"."+e+"\\s*}}","g");o=o.replace(i,n)}):o=o.replace(a,n)}),o}}),define("sfModal",["jquery","template"],function(e,t){return function(n){if("object"!=typeof n){if("hide"===n)return void e(".sfmodal").modal("hide");if("toggle"===n)return void e(".sfmodal").modal("toggle");n={content:n,hideDone:!0}}var o=e.extend({hideTitle:!1,hideFooter:!1,title:"警告：前方高能！",content:"玩脱了",wrapper:null,$content:null,hideClose:!1,closeText:"取消",hideDone:!1,doneText:"确认",doneFn:function(){e(".sfmodal").modal("hide")},show:function(){},shown:function(){},hide:function(){},hidden:function(){},loaded:function(){}},n),i='<div class="sfmodal modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">  <div class="modal-dialog">    <div class="modal-content">      '+(o.hideTitle?"":'<div class="modal-header">        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>        <h4 class="modal-title">{{title}}</h4>      </div>')+'<div class="modal-body">        <p class="sfModal-content">          </div>          <div class="modal-footer '+(o.hideFooter?"hidden":"")+'">'+(o.hideClose?"":'<button type="button" class="btn btn-default" data-dismiss="modal">{{closeText}}</button>')+(o.hideDone?"":'<button type="button" class="btn btn-primary done-btn">{{doneText}}</button>')+"</div>        </div>      </div>    </div>";e(".sfmodal").length>0&&(e(".sfmodal").remove(),e(".modal-backdrop").remove()),o.wrapper?(e(o.wrapper).append(t(i,o)),e(o.wrapper).append('<div class="modal-backdrop in"></div>')):e("body").append(t(i,o)),o.$content?e(".sfmodal .sfModal-content").append(o.$content):e(".sfmodal .sfModal-content").html(o.content),e(".sfmodal").modal({keyboard:!0}),e(".sfmodal").on("show.bs.modal",o.show).on("shown.bs.modal",o.shown).on("hide.bs.modal",function(t){o.hide(t),o.wrapper&&e(".modal-backdrop").remove()}).on("hidden.bs.modal",o.hidden).on("loaded.bs.modal",o.loaded).modal("show"),e(".sfmodal .done-btn").click(function(t){o.doneFn(t),o.wrapper&&e(".modal-backdrop").remove()})}}),define("mobile",["jquery"],function(e){return window.innerWidth>767?{login:null,signup:null}:(e(".hate, .like").data("toggle","false"),{login:function(){location.href="/user/login"},signup:function(){location.href="/user/register"}})}),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var o=0;window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(o+16,t);return setTimeout(function(){e(o=n)},n-t)},window.cancelAnimationFrame=clearTimeout}}(),function(e){e.snowfall=function(t,n){function o(o,i,a,s){this.x=o,this.y=i,this.size=a,this.speed=s,this.step=0,this.stepSize=r(1,10)/100,n.collection&&(this.target=m[r(0,m.length-1)]);var l=null;n.image?(l=document.createElement("img"),l.src=n.image):(l=document.createElement("div"),e(l).css({background:n.flakeColor}),e(l).text("❄")),e(l).attr({"class":"snowfall-flakes"}).css({width:this.size,height:this.size,position:n.flakePosition,top:this.y,left:this.x,fontSize:this.size,zIndex:n.flakeIndex,"text-shadow":"2px 2px 2px #AAA",color:"#FFF","pointer-events":"none"}),e(t).get(0).tagName===e(document).get(0).tagName?(e("body").append(e(l)),t=e("body")):e(t).append(e(l)),this.element=l,this.update=function(){if(this.y+=this.speed,this.y>d-(this.size+6)&&this.reset(),this.element.style.top=this.y+"px",this.element.style.left=this.x+"px",this.step+=this.stepSize,this.x+=b===!1?Math.cos(this.step):b+Math.cos(this.step),n.collection&&this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var e=this.target.element.getContext("2d"),t=this.x-this.target.x,o=this.y-this.target.y,i=this.target.colData;if(void 0!==i[parseInt(t)][parseInt(o+this.speed+this.size)]||o+this.speed+this.size>this.target.height)if(o+this.speed+this.size>this.target.height){for(;o+this.speed+this.size>this.target.height&&this.speed>0;)this.speed*=.5;e.fillStyle="#fff",void 0==i[parseInt(t)][parseInt(o+this.speed+this.size)]?(i[parseInt(t)][parseInt(o+this.speed+this.size)]=1,e.fillRect(t,o+this.speed+this.size,this.size,this.size)):(i[parseInt(t)][parseInt(o+this.speed)]=1,e.fillRect(t,o+this.speed,this.size,this.size)),this.reset()}else this.speed=1,this.stepSize=0,parseInt(t)+1<this.target.width&&void 0==i[parseInt(t)+1][parseInt(o)+1]?this.x++:parseInt(t)-1>0&&void 0==i[parseInt(t)-1][parseInt(o)+1]?this.x--:(e.fillStyle="#fff",e.fillRect(t,o,this.size,this.size),i[parseInt(t)][parseInt(o)]=1,this.reset())}(this.x+this.size>c-u||this.x<u)&&this.reset()},this.reset=function(){this.y=0,this.x=r(u,c-u),this.stepSize=r(1,10)/100,this.size=r(100*n.minSize,100*n.maxSize)/100,this.element.style.width=this.size+"px",this.element.style.height=this.size+"px",this.speed=r(n.minSpeed,n.maxSpeed)}}function i(){for(l=0;l<a.length;l+=1)a[l].update();f=requestAnimationFrame(function(){i()})}var a=[],s={flakeCount:35,flakeColor:"transparent",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:!1,shadow:!1,collection:!1,collectionHeight:40,deviceorientation:!1},n=e.extend(s,n),r=function(e,t){return Math.round(e+Math.random()*(t-e))};e(t).data("snowfall",this);var l=0,d=e(t).height(),c=e(t).width(),u=0,f=0;if(n.collection!==!1){var p=document.createElement("canvas");if(p.getContext&&p.getContext("2d"))for(var m=[],h=e(n.collection),v=n.collectionHeight,l=0;l<h.length;l++){var g=h[l].getBoundingClientRect(),w=e("<canvas/>",{"class":"snowfall-canvas"}),x=[];if(g.top-v>0){e("body").append(w),w.css({position:n.flakePosition,left:g.left+"px",top:g.top-v+"px"}).prop({width:g.width,height:v});for(var y=0;y<g.width;y++)x[y]=[];m.push({element:w.get(0),x:g.left,y:g.top-v,width:g.width,height:v,colData:x})}}else n.collection=!1}for(e(t).get(0).tagName===e(document).get(0).tagName&&(u=25),e(window).bind("resize",function(){d=e(t)[0].clientHeight,c=e(t)[0].offsetWidth}),l=0;l<n.flakeCount;l+=1)a.push(new o(r(u,c-u),r(0,d),r(100*n.minSize,100*n.maxSize)/100,r(n.minSpeed,n.maxSpeed)));n.round&&e(".snowfall-flakes").css({"-moz-border-radius":n.maxSize,"-webkit-border-radius":n.maxSize,"border-radius":n.maxSize}),n.shadow&&e(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"});var b=!1;n.deviceorientation&&e(window).bind("deviceorientation",function(e){b=.1*e.originalEvent.gamma}),i(),this.clear=function(){e(".snowfall-canvas").remove(),e(t).children(".snowfall-flakes").remove(),cancelAnimationFrame(f)}},e.fn.snowfall=function(t){return"object"==typeof t||void 0==t?this.each(function(){new e.snowfall(this,t)}):"string"==typeof t?this.each(function(){var t=e(this).data("snowfall");t&&t.clear()}):void 0}}(jQuery),define("jquery_snowfall",["jquery"],function(e){return function(){var t;return t||e.$.fn.snowfall}}(this)),define("christmas",["jquery","jquery_snowfall"],function(e){function t(t){var n=127,o=["E4","E4","E4","C4","E4","G4","G3","C4","G3","E3","A3","B3","Ab3","A3","G3","E4","G4","A4","F4","G4","E4","C4","D4","B3","C4","G3","E3","A3","B3","Ab3","A3","G3","E4","G4","A4","F4","G4","E4","C4","D4","B3","G4","F4","E4","Db4","E4","Gb3","A3","C4","A3","C4","D4","G4","F4","E4","Db4","E4","C5","C5","C5","G4","F4","E4","Db4","E4","Gb3","A3","C4","A3","C4","D4","Db4","D4","C4","C4","C4","C4","C4","D4","E4","C4","A3","G3","C4","C4","C4","C4","D4","E4","C4","C4","C4","C4","D4","E4","C4","A3","G3"],i=[8,4,4,8,4,2,2,3,3,3,4,4,8,4,8,8,8,4,8,4,3,8,8,3,3,3,3,4,4,8,4,8,8,8,4,8,4,3,8,8,2,8,8,8,4,4,8,8,4,8,8,3,8,8,8,4,4,4,8,2,8,8,8,4,4,8,8,4,8,8,3,3,3,1,8,4,4,8,4,8,4,8,2,8,4,4,8,4,1,8,4,4,8,4,8,4,8,2],a=["D4","D4","B3","A4","G4","D4","D4","D4","D4","D4","B4","A4","G4","E4","E4","E4","E4","C5","B4","A4","F4","F4","F4","D5","D5","C5","A4","B4","B4","D4","D4","B4","A4","G4","D4","D4","D4","D4","B4","A4","G4","E4","E4","E4","E4","C5","B4","A4","D5","D5","D5","D5","E5","D5","C5","A4","G4","G4","B4","B4","B4","B4","B4","B4","B4","D5","G4","A4","B4","B4","C5","C5","C5","C5","C5","B4","B4","B4","B4","B4","A4","A4","G4","A4","D5","B4","B4","B4","B4","B4","B4","B4","D5","G4","A4","B4","B4","C5","C5","C5","C5","C5","B4","B4","B4","B4","D5","D5","C5","A4","G4","G4"],s=[8,8,8,8,8,4,8,16,16,8,8,8,8,4,8,8,8,8,8,8,4,8,8,8,8,8,8,4,8,8,8,8,8,8,4,8,8,8,8,8,8,4,8,8,8,8,8,8,8,8,8,8,8,8,8,8,4,8,8,8,4,8,8,4,8,8,8,8,4,4,8,8,8,8,8,8,8,16,16,8,8,8,8,4,4,8,8,4,8,8,4,8,8,8,8,4,4,8,8,8,8,8,8,8,16,16,8,8,8,8,4,8];return window.MIDI?void MIDI.loadPlugin({targetFormat:"mp3",soundfontUrl:SF.staticUrl+"/build/3rd/midijs/",instrument:"marimba",callback:function(){MIDI.setVolume(0,127),MIDI.programChange(0,12);var e=1;"mario"===t?o.forEach(function(t,o){var a=1.3/i[o],s=MIDI.keyToNote[t];MIDI.noteOn(0,s,n,e),MIDI.noteOff(0,s,e+a),e+=a}):"jb"===t&&a.forEach(function(t,o){var i=2/s[o],a=MIDI.keyToNote[t];MIDI.noteOn(0,a,n,e),MIDI.noteOff(0,a,e+i),e+=i})}}):void e.getScript(SF.staticUrl+"/build/3rd/midijs/MIDI.js",function(){MIDI.loadPlugin({targetFormat:"mp3",soundfontUrl:SF.staticUrl+"/build/3rd/midijs/",instrument:"marimba",callback:function(){MIDI.setVolume(0,127),MIDI.programChange(0,12);var r=1;"mario"===t?o.forEach(function(e,t){var o=1.3/i[t],a=MIDI.keyToNote[e];MIDI.noteOn(0,a,n,r),MIDI.noteOff(0,a,r+o),r+=o}):"jb"===t&&a.forEach(function(e,t){var o=2/s[t],i=MIDI.keyToNote[e];MIDI.noteOn(0,i,n,r),MIDI.noteOff(0,i,r+o),r+=o});var l=0;e("input[type=text]").keypress(function(){var t=2/s[l],o=MIDI.keyToNote[a[l]];MIDI.noteOn(0,o,n,0),MIDI.noteOff(0,o,t),"searchBox"===e(this).attr("id")&&l>110?l=0:l++}),e("textarea").keypress(function(){var e=1.3/i[l],t=MIDI.keyToNote[o[l]];MIDI.noteOn(0,t,n,0),MIDI.noteOff(0,t,e),l++})}})})}function n(){e("#christmasBlur, #blurClose").remove(),e("body").append('<a href="javascript:void(0);" id="blurClose">❄</a>');var t=e('<canvas id="christmasBlur"></canvas>')[0];t.width=e(document).width(),t.height=e(document).height(),t.style.position="absolute",t.style.top="0px",t.style.zIndex="1001",t.style.left="0px",t.style.cursor="-webkit-grab",document.body.appendChild(t);var n=function(){function e(e,i){var a=e-n,s=i-o;t.beginPath(),t.arc(a,s,25,0,2*Math.PI),t.closePath(),t.fill()}var t,n,o;return{init:function(i){var a=!1;t=i.getContext("2d"),n=i.offsetLeft,o=i.offsetTop;var s=+("ontouchstart"in window),r={start:["mousedown","touchstart"],end:["mouseup","touchend"],move:["mousemove","touchmove"]};i.addEventListener(r.start[s],function(t){a=!0,t=s?t.targetTouches[0]:t,e(t.pageX,t.pageY)},!1),i.addEventListener(r.end[s],function(){a=!1},!1),i.addEventListener(r.move[s],function(t){a&&(t=s?t.targetTouches[0]:t,e(t.pageX,t.pageY))},!1)}}}(),o=t.getContext("2d");o.globalAlpha=.75,o.fillStyle="rgb(250, 250, 250)",o.fillRect(0,0,t.width,t.height),o.globalCompositeOperation="destination-out",n.init(t),e("#blurClose").css({fontSize:"50px",color:"#FFF",textShadow:"0 0 5px #999",position:"fixed",zIndex:2e3,top:"30px",lineHeight:"50px",right:"40px",textDecoration:"none","-webkit-animation-name":"spin","-webkit-animation-duration":"4000ms","-webkit-animation-iteration-count":"infinite","-webkit-animation-timing-function":"linear","-moz-animation-name":"spin","-moz-animation-duration":"4000ms","-moz-animation-iteration-count":"infinite","-moz-animation-timing-function":"linear","-ms-animation-name":"spin","-ms-animation-duration":"4000ms","-ms-animation-iteration-count":"infinite","-ms-animation-timing-function":"linear","animation-name":"spin","animation-duration":"4000ms","animation-iteration-count":"infinite","animation-timing-function":"linear"}).click(function(){e(t).remove(),e("#blurClose").remove(),e(document).snowfall("clear")}),e(document).scroll(function(){e(t).remove(),e("#blurClose").remove(),e(document).snowfall("clear")}),e(document).keydown(function(n){27===n.keyCode&&(e(t).remove(),e("#blurClose").remove(),e(document).snowfall("clear"))})}function o(t){if(e(document).snowfall("clear"),0!==t)if(1/0===t||"Infinity"===t)e(document).snowfall({minSize:10,maxSize:32});else{var n=1e3*t||6e4;e(document).snowfall({minSize:10,maxSize:32}),setTimeout(function(){e(document).snowfall("clear")},n)}}return{snow:o,blur:n,play:t,go:function(e){return o(e),t("jb"),"Merry Christmas!"},python:function(e){return o(e),t("mario"),"人生苦短，我上SegmentFault！Python 25岁生日快乐！"}}}),function(e){e.fn.hoverIntent=function(t,n,o,i){var a={interval:i||400,sensitivity:5,timeout:600};a="object"==typeof t?e.extend(a,t):e.isFunction(n)?e.extend(a,{over:t,out:n,selector:o}):e.extend(a,{over:t,out:t,selector:n});var s,r,l,d,c=function(e){s=e.pageX,r=e.pageY},u=function(t,n){return n.hoverIntent_t=clearTimeout(n.hoverIntent_t),Math.sqrt((l-s)*(l-s)+(d-r)*(d-r))<a.sensitivity?(e(n).off("mousemove.hoverIntent",c),n.hoverIntent_s=!0,a.over.apply(n,[t])):(l=s,d=r,n.hoverIntent_t=setTimeout(function(){u(t,n)},a.interval),void 0)},f=function(e,t){return t.hoverIntent_t=clearTimeout(t.hoverIntent_t),t.hoverIntent_s=!1,a.out.apply(t,[e])},p=function(t){var n=e.extend({},t),o=this;o.hoverIntent_t&&(o.hoverIntent_t=clearTimeout(o.hoverIntent_t)),"mouseenter"===t.type?(l=n.pageX,d=n.pageY,e(o).on("mousemove.hoverIntent",c),o.hoverIntent_s||(o.hoverIntent_t=setTimeout(function(){u(n,o)},a.interval))):(e(o).off("mousemove.hoverIntent",c),o.hoverIntent_s&&(o.hoverIntent_t=setTimeout(function(){f(n,o)},a.timeout)))};return this.on({"mouseenter.hoverIntent":p,"mouseleave.hoverIntent":p},a.selector)}}(jQuery),define("jquery_hoverIntent",["jquery"],function(e){return function(){var t;return t||e.$.fn.hoverIntent}}(this)),define("sfAjax",["jquery"],function(e){e.sfAjax=function(t,n,o,i){function a(e,t){return 0===t.indexOf(e)?t.slice(e.length):e+t}var s=e.extend({id:t.data("id"),"do":t.data("do"),type:t.data("type")},o),r=s.do,l=a("un",r),d="/api/"+s.type;e.post(d,s,function(e){0===e.status?(t.data("do",l),n(e)):i&&i(e)})}}),function(e){"function"==typeof define&&define.amd?define("jquery_cookie",["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return r.raw?e:encodeURIComponent(e)}function n(e){return r.raw?e:decodeURIComponent(e)}function o(e){return t(r.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),r.json?JSON.parse(e):e}catch(t){}}function a(t,n){var o=r.raw?t:i(t);return e.isFunction(n)?n(o):o}var s=/\+/g,r=e.cookie=function(i,s,l){if(void 0!==s&&!e.isFunction(s)){if(l=e.extend({},r.defaults,l),"number"==typeof l.expires){var d=l.expires,c=l.expires=new Date;c.setTime(+c+864e5*d)}return document.cookie=[t(i),"=",o(s),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=i?void 0:{},f=document.cookie?document.cookie.split("; "):[],p=0,m=f.length;m>p;p++){var h=f[p].split("="),v=n(h.shift()),g=h.join("=");if(i&&i===v){u=a(g,s);break}i||void 0===(g=a(g))||(u[v]=g)}return u};r.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),define("main",["jquery","sfModal","mobile","christmas","jquery_hoverIntent","sfAjax","bootstrap","jquery_cookie"],function(e,t,n,o){function i(){e.getJSON("/api/user",{"do":"stat"},function(t){if(0===t.status){var n=e("title");t.data.events>0?(t.data.events>99&&(t.data.events="99+"),e("#messageCount").siblings(".has-unread__count").remove(),e("#messageCount").after('<span class="has-unread__count">'+t.data.events+"</span>"),e("#m-messageCount").text(t.data.events),e(".mobile-menu__unreadpoint").show(),n.text(/^\(\d+[\+]?\)/.test(n.text())?n.text().replace(/^\(\d+[\+]?\)/,"("+t.data.events+")"):"("+t.data.events+")"+e("title").text())):0===t.data.events&&(e(".has-unread__count").remove(),n.text(n.text().replace(/^\(\d+[\+]?\)/,""))),0!==t.data.drafts&&(e("#draftCount .badge").remove(),e("#draftCount").append('<span class="badge">'+t.data.drafts+"</span>")),0!==t.data.invites&&(e("#inviteCount .badge").remove(),e("#inviteCount").append('<span class="badge">'+t.data.invites+"</span>")),e(".misc-santa").find("img").css("width",70+30*Math.log(t.data.daily>1?t.data.daily:1))}})}function a(e,t,n){document.cookie=n?e+"="+t+"; expires="+n+";":e+"="+t}function s(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function r(){t({title:"登录",doneText:"登陆",hideClose:!0,hideDone:!0,hideFooter:!0,content:e("#loginModal").text(),show:function(){e("#loginEmail").focus(),e("#loginShowMore").click(function(t){t.preventDefault(),e(this).hide(),e("#loginMore").removeClass("hide")}),e(".sfmodal .widget-login a").click(function(t){t.preventDefault(),window.open(e(this).attr("href"),"_blank","toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=500")}),e(".login_form").submit(function(){var t={mail:e("#loginEmail").val(),password:e("#loginPassword").val(),remember:e("#loginRemember:checked").length};return e.post("/api/user?do=login",t,function(t){e(".msg").remove(),1===t.status&&"form"===t.data[0]?e.each(t.data[1],function(t,n){e('input[name="'+t+'"]').before('<span class="msg pull-right text-danger">'+n+"</span>")}):0===t.status&&(location.href=document.referrer.indexOf(location.hostname)>0?document.referrer:t.data)}),!1})}})}window.MerryChristmas=o.go,window.Python=o.python,window.Snow=o.snow,console.info("❄❄❄❄ MerryChristmas ❄❄❄❄"),-1===document.cookie.indexOf("christmased=1")&&(o.snow(),a("christmased",1)),location.hash.match(/christmas|snow|圣诞|下雪/i)&&o.go(),window.onhashchange=function(){location.hash.match(/christmas|snow|圣诞|下雪/i)&&o.go()},e(".header-search").submit(function(){return e("#searchBox").val().match(/^christmas|snow|圣诞|下雪/i)&&!e(".snowfall-flakes").length?(o.go(),!1):void 0}),window.oauthLogin=function(){window.openner?location.reload():location.href="http://segmentfault.com"},window.oauthRegister=function(){location.href="/user/bind"};var l={_:window.SF.token,staticUrl:window.SF.staticUrl,userId:e("#SFUserId").attr("value"),userRank:e("#SFUserRank").attr("value"),getMessage:i,login:n.login||r};e(document).ajaxError(function(e,n,o){413===n.status?t("图片太大了！"):console.log("Ajax "+n.status+": ",o.url)}),e(document).ajaxSend(function(e,t,n){n.url=-1===n.url.indexOf("?")?n.url+"?_="+l._:n.url+"&_="+l._}),e(document).ajaxComplete(function(n,o,i){if(o.responseText)if(-1!==o.responseText.indexOf("<br />")||-1!==o.responseText.indexOf("<pre>exception "))console.log("警告：前方高能！",o.responseText);else if(o.responseJSON&&0===o.responseJSON.status)(-1===i.url.indexOf("do=autoComplete")||-1===i.url.indexOf("draft"))&&(e(".error, .has-error").removeClass("error has-error"),e(".error--msg").remove());else if(o.responseJSON&&1===o.responseJSON.status){var a=o.responseJSON;if(-1===i.url.indexOf("do=stat")&&"login"===a.data[0])l.login();else if("robot"===a.data[0])location.href="/stop-robot";else if("author"===a.data[0])t({title:"限制作者本人",content:"你是作者，无法对自己进行此操作",hideDone:!0});else if("follow"===a.data[0])t({title:"限制本人",content:"无法对自己进行此操作",hideDone:!0});else if("rank"===a.data[0])t({title:"声望值不够",content:"此操作要求你的声望值至少达到 "+a.data[1]+'，<a href="http://segmentfault.com/repu">如何获得声望？</a>',hideDone:!0});else if("form"===a.data[0]){var s=/^\/api\/(\w*)\?/,r=s.exec(i.url)[1];e.each(a.data[1],function(t,n){var o=t.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),a="#"+r+o;if("comment"===r){var s=/id=(\d*)/,l=s.exec(i.data)[1];a=a+"-"+l,e(a).next(".error--msg").remove(),e(a).addClass("error").after('<span class="error--msg">'+n+"</span>")}else e("form#"+r+" *[name="+t+"]").siblings(".error--msg").remove(),e("form#"+r+" *[name="+t+"]").addClass("error").attr("data-error",n).after('<span class="error--msg">'+n+"</span>"),e("form#"+r+" *[name="+t+"]").parent(".form-group").addClass("has-error"),e(a).addClass("error").attr("data-error",n).after('<span class="error--msg">'+n+"</span>")})}}}),e("body").delegate("form","submit",function(t){var n=e(this);n.attr("method")&&n.attr("action")&&(t.preventDefault(),n.find("button[type=submit]").attr("disabled","disabled"),e.ajax({url:n.attr("action"),type:n.attr("method"),data:n.serialize(),success:function(e){n.find("button[type=submit]").removeAttr("disabled"),0===e.status&&(/^\//.test(e.data)?window.location=e.data:window.location.reload())}}))}),e("body").delegate("form input","keydown",function(){e(this).removeClass("error"),e(this).parent(".form-group").removeClass("has-error"),e(this).next(".error--msg").remove()});var d=null;l.userId&&(i(),d=setInterval(i,6e4));var c,u;"undefined"!=typeof document.hidden?(c="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(c="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(c="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(c="webkitHidden",u="webkitvisibilitychange");var f,p=!1;e(document).on(u,function(){document[c]?(clearInterval(d),e("#blurClose").length||(f=setTimeout(function(){p=!0,o.blur()},6e5))):(clearInterval(f),p&&(o.snow(1/0),p=!1),l.userId&&(i(),d=setInterval(i,6e4)))}),e("#searchBox").focus(function(){var t=e(".nav .menu").width()+180+"px";e(".nav .menu").hide(),e(this).animate({width:t},200)}),e("#searchBox").blur(function(){e(this).animate({width:"180px"},200,"swing",function(){e(".nav .menu").show()})}),e("#backtop").click(function(){return e("body,html").animate({scrollTop:0}),!1}),e(document).scroll(function(){e(this).scrollTop()>720?e("#backtop").removeClass("hidden"):e("#backtop").addClass("hidden")}),e("#topNotify").length&&e("body,html").animate({scrollTop:0}),l.userId||(-1!==document.cookie.indexOf("sfln=1")?(e(".login-notify").css("bottom","0"),document.cookie="sfln=0"):document.cookie="sfln=1"),e(".login-notify .close").click(function(){document.cookie="sfln=0",e(".login-notify").css("bottom","-209px")}),window.SFHacker={setOldVersion:function(){a("v","old"),window.location.reload()},unSetOldVersion:function(){s("v"),window.location.reload()},makePureTextarea:function(){a("typemode","native"),window.location.reload()},unMakePureTextarea:function(){s("typemode"),window.location.reload()},snow:function(e){o.snow(e)}},e("#sfLogin").click(function(e){e.preventDefault(),l.login()}),e(".3rdLogin").click(function(t){t.preventDefault(),window.open(e(this).attr("href"),"_blank","toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=500")}),e(".hoverDropdown").hoverIntent(function(){e(this).hasClass("open")||e(this).find(".dropdownBtn").dropdown("toggle")},function(){e(this).hasClass("open")&&e(this).find(".dropdownBtn").dropdown("toggle")},null,1),e(".dropdownBtn").click(function(t){e(this).parent(".hoverDropdown").hasClass("open")&&(t.preventDefault(),location.href=e(this).attr("href"))});var m=e(".misc-santa");return m.css("right",80),e(".misc-santa").find("img").css("width",70),"true"==e.cookie("showOldMan")&&m.removeClass("hide"),e(".qrcodeWraper a").click(function(){m.toggleClass("hide"),m.hasClass("hide")?e.cookie("showOldMan",!1,{expires:7,path:"/"}):e.cookie("showOldMan",!0,{expires:7,path:"/"})}),l}),function(e){function t(t,n,o,i){var a={data:i||0===i||i===!1?i:n?n.data:{},_wrap:n?n._wrap:null,tmpl:null,parent:n||null,nodes:[],calls:d,nest:c,wrap:u,html:f,update:p};return t&&e.extend(a,t,{nodes:[],parent:n}),o&&(a.tmpl=o,a._ctnt=a._ctnt||a.tmpl(e,a),a.key=++b,(C.length?x:w)[b]=a),a}function n(t,i,a){var s,r=a?e.map(a,function(e){return"string"==typeof e?t.key?e.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+v+'="'+t.key+'" $2'):e:n(e,t,e._ctnt)}):t;return i?r:(r=r.join(""),r.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(t,n,i,a){s=e(i).get(),l(s),n&&(s=o(n).concat(s)),a&&(s=s.concat(o(a)))}),s?s:o(r))}function o(t){var n=document.createElement("div");return n.innerHTML=t,e.makeArray(n.childNodes)}function i(t){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+e.trim(t).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(t,n,o,i,a,r,l){var d,c,u,f=e.tmpl.tag[o];if(!f)throw"Unknown template tag: "+o;return d=f._default||[],r&&!/\w$/.test(a)&&(a+=r,r=""),a?(a=s(a),l=l?","+s(l)+")":r?")":"",c=r?a.indexOf(".")>-1?a+s(r):"("+a+").call($item"+l:a,u=r?c:"(typeof("+a+")==='function'?("+a+").call($item):("+a+"))"):u=c=d.$1||"null",i=s(i),"');"+f[n?"close":"open"].split("$notnull_1").join(a?"typeof("+a+")!=='undefined' && ("+a+")!=null":"true").split("$1a").join(u).split("$1").join(c).split("$2").join(i||d.$2||"")+"__.push('"})+"');}return __;")}function a(t,o){t._wrap=n(t,!0,e.isArray(o)?o:[g.test(o)?o:e(o).html()]).join("")}function s(e){return e?e.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function r(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}function l(n){function o(n){function o(e){e+=d,s=c[e]=c[e]||t(s,w[s.parent.key+d]||s.parent)}var i,a,s,r,l=n;if(r=n.getAttribute(v)){for(;l.parentNode&&1===(l=l.parentNode).nodeType&&!(i=l.getAttribute(v)););i!==r&&(l=l.parentNode?11===l.nodeType?0:l.getAttribute(v)||0:0,(s=w[r])||(s=x[r],s=t(s,w[l]||x[l]),s.key=++b,w[b]=s),I&&o(r)),n.removeAttribute(v)}else I&&(s=e.data(n,"tmplItem"))&&(o(s.key),w[s.key]=s,l=e.data(n.parentNode,"tmplItem"),l=l?l.key:0);if(s){for(a=s;a&&a.key!=l;)a.nodes.push(n),a=a.parent;delete s._ctnt,delete s._wrap,e.data(n,"tmplItem",s)}}var i,a,s,r,l,d="_"+I,c={};for(s=0,r=n.length;r>s;s++)if(1===(i=n[s]).nodeType){for(a=i.getElementsByTagName("*"),l=a.length-1;l>=0;l--)o(a[l]);o(i)}}function d(e,t,n,o){return e?void C.push({_:e,tmpl:t,item:this,data:n,options:o}):C.pop()}function c(t,n,o){return e.tmpl(e.template(t),n,o,this)}function u(t,n){var o=t.options||{};return o.wrapped=n,e.tmpl(e.template(t.tmpl),t.data,o,t.item)}function f(t,n){var o=this._wrap;return e.map(e(e.isArray(o)?o.join(""):o).filter(t||"*"),function(e){return n?e.innerText||e.textContent:e.outerHTML||r(e)})}function p(){var t=this.nodes;e.tmpl(null,null,null,this).insertBefore(t[0]),e(t).remove()}var m,h=e.fn.domManip,v="_tmplitem",g=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,w={},x={},y={key:0,data:{}},b=0,I=0,C=[];e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){e.fn[t]=function(o){var i,a,s,r,l=[],d=e(o),c=1===this.length&&this[0].parentNode;if(m=w||{},c&&11===c.nodeType&&1===c.childNodes.length&&1===d.length)d[n](this[0]),l=this;else{for(a=0,s=d.length;s>a;a++)I=a,i=(a>0?this.clone(!0):this).get(),e(d[a])[n](i),l=l.concat(i);I=0,l=this.pushStack(l,t,d.selector)}return r=m,m=null,e.tmpl.complete(r),l}}),e.fn.extend({tmpl:function(t,n,o){return e.tmpl(this[0],t,n,o)},tmplItem:function(){return e.tmplItem(this[0])},template:function(t){return e.template(t,this[0])},domManip:function(t,n,o){if(t[0]&&e.isArray(t[0])){for(var i,a=e.makeArray(arguments),s=t[0],r=s.length,l=0;r>l&&!(i=e.data(s[l++],"tmplItem")););i&&I&&(a[2]=function(t){e.tmpl.afterManip(this,t,o)}),h.apply(this,a)}else h.apply(this,arguments);return I=0,!m&&e.tmpl.complete(w),this}}),e.extend({tmpl:function(o,i,s,r){var l,d=!r;if(d)r=y,o=e.template[o]||e.template(null,o),x={};else if(!o)return o=r.tmpl,w[r.key]=r,r.nodes=[],r.wrapped&&a(r,r.wrapped),e(n(r,null,r.tmpl(e,r)));return o?("function"==typeof i&&(i=i.call(r||{})),s&&s.wrapped&&a(s,s.wrapped),l=e.isArray(i)?e.map(i,function(e){return e?t(s,r,o,e):null}):[t(s,r,o,i)],d?e(n(r,null,l)):l):[]},tmplItem:function(t){var n;for(t instanceof e&&(t=t[0]);t&&1===t.nodeType&&!(n=e.data(t,"tmplItem"))&&(t=t.parentNode););return n||y},template:function(t,n){return n?("string"==typeof n?n=i(n):n instanceof e&&(n=n[0]||{}),n.nodeType&&(n=e.data(n,"tmpl")||e.data(n,"tmpl",i(n.innerHTML))),"string"==typeof t?e.template[t]=n:n):t?"string"!=typeof t?e.template(null,t):e.template[t]||e.template(null,g.test(t)?t:e(t)):null},encode:function(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),e.extend(e.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){w={}},afterManip:function(t,n,o){var i=11===n.nodeType?e.makeArray(n.childNodes):1===n.nodeType?[n]:[];o.call(t,n),l(i),I++}})}(jQuery),define("jquery_tmpl",["jquery"],function(e){return function(){var t;return t||e.$.fn.tmpl}}(this)),define("statusToggle",[],function(){return function(e){e.data("toggle","false"),e.data("toggle")&&(e.on("active",function(t,n){e.data("toggle","true"),n.call(this)}),e.on("unactive",function(t,n){e.data("toggle","true"),n.call(this)}))}}),define("follow",["statusToggle"],function(e){return function(t){var n=$.extend({element:null,event:"click",url:null,toggleClass:"active",loadText:"加载中",unActiveText:"加关注",activeText:"已关注","do":"follow",successFn:function(){},failFn:function(){}},t),o=t.element;e(o),o.on(n.event,function(){o.hasClass(n.toggleClass)?o.trigger("unactive",function(){o.text(n.unActiveText).removeClass(n.toggleClass).attr("disabled","disabled"),$.post(n.url,{"do":"un"+n.do,id:n.element.data("id")},function(e){0===e.status?n.successFn.call(this,e):(o.text(n.activeText),n.failFn.call(this,e)),o.removeAttr("disabled")})}):o.trigger("active",function(){o.text(n.activeText).addClass(n.toggleClass).attr("disabled","disabled"),$.post(n.url,{"do":n.do,id:n.element.data("id")},function(e){0===e.status?n.successFn.call(this,e):(o.text(n.unActiveText),n.failFn.call(this,e)),o.removeAttr("disabled")})})})}}),define("tagPopup",["jquery","sfModal","follow","jquery_tmpl"],function(e,t,n){e.fn.tagPopup=function(o){function i(){e.getJSON("/api/tag",{id:a.data("id"),"do":"show"},function(o){if(0!==o.status)t("○|￣|_  出错了！");else{s.content=o.data.excerpt?o.data.excerpt:'<span class="text-muted">目前还没有关于这个标签的解释</span>',o.data.isFollowed?(o.data.isFollowedClass="active",o.data.isFollowedBtn="已关注"):(o.data.isFollowedClass="",o.data.isFollowedBtn="加关注"),s.template=e.tmpl(s.template,o.data)[0],a.popover(s),a.popover("show");var i=a.siblings(".tag-popup").find("button");n({element:i,url:"/api/tag",successFn:function(t){e(".tag-popup-"+i.data("id")+" .followers").text(t.data+"人")}})}})}var a=e(this),s={placement:a.data("placement")||"top",trigger:"manual",content:"",html:!0,template:'<div class="popover tag-popup tag-popup-${id}">                <div class="arrow"></div>                <h3 class="popover-title"></h3>                <div class="popover-content"></div>                <div class="popover-footer">                    <a href="${url}">查看</a>                    <span class="text-muted">&middot;</span>                    <a href="${editUrl}">编辑</a>                    <div class="pull-right">                        <span class="text-muted followers">${followers} 人</span>                        <button class="btn btn-default btn-xs tagfollow ${isFollowedClass}" data-id="${id}">${isFollowedBtn}</button></div>                </div>            </div>'};
"show"===o?0===a.siblings(".tag-popup").length?i():a.siblings(".tag-popup").show():"hide"===o&&a.siblings(".tag-popup").hide()}}),requirejs(["jquery","main","jquery_tmpl","jquery_hoverIntent","tagPopup"],function(e,t){function n(){e.getJSON("/api/question?do=listUnAnswered&limit=1&page=1&created="+i,function(t){i=t.data[0].created;var n=e.tmpl(o,t.data[0]);e("#recQuestion").remove(),e(".question-stream section:nth-child(4)").after(n)})}e(".tagPopup").hoverIntent(function(){var t=e(this).find(".tag");e(".tag").tagPopup("hide"),t.tagPopup("show")},function(){var t=e(this).find(".tag");t.tagPopup("hide")}),e("#goAsk").click(function(e){t.userId||(e.preventDefault(),t.login())});var o='<section id="recQuestion" data-created="{{ created }}" class="stream-list__item"><div class="qa-rank"><div class="votes{{if votes < 0}} minus{{/if}} hidden-xs">        ${ votes }<small>投票</small></div> <div class="answers">        ${ answers }<small>回答</small></div> <div class="views hidden-xs">        ${ viewsWord }<small>浏览</small></div> </div><div class="summary"><ul class="author list-inline"><li>        <a href="${ user.url }">${ user.name }</a> <span class="split"></span>        <a href="${ url }">${ createdDate }提问</a></li></ul><h2 class="title">        <a href="${ url }">${ title }</a></h2><ul class="taglist--inline ib">        {{each tags}}<li class="tagPopup"><a class="tag tag-sm" href="${url}" data-toggle="popover" data-original-title="${name}" data-id="${id}">${name}</a></li>{{/each}}        </ul></div></section>',i=e(".askDate").last().data("created");""===i&&(i=Math.floor(Date.now()/1e3-86400)),"/"===location.pathname&&(n(),setInterval(function(){n()},3e5))}),define("qa_index",function(){});